import lc3b_types::*;

module forward_unit
(
	//inputs/outputs here

	input logic ex_mem_regwrite,
	input logic [2:0] id_ex_sr1,
	input logic [2:0] id_ex_sr2,
	input logic [2:0] id_ex_dr,
	input logic [2:0] ex_mem_dr,
	input logic id_ex_in_st,
	input logic ex_mem_in_ld,
	input logic mem_wb_regwrite,
	input logic [2:0] mem_wb_dr,
	
	output logic [1:0] forward1,
	output logic [1:0] forward2
);

always_comb
begin
	if(ex_mem_regwrite && (ex_mem_dr == id_ex_sr1) && !(ex_mem_in_ld))
		forward1 = 2'b01;
	else if(ex_mem_regwrite && (ex_mem_dr == id_ex_sr1))
		forward1 = 2'b10;
	else if(mem_wb_regwrite && (mem_wb_dr == id_ex_sr1))
		forward1 = 2'b11;
	else
		forward1 = 2'b00;
		
	if(ex_mem_regwrite && ((ex_mem_dr == id_ex_sr2) || (id_ex_in_st && (ex_mem_dr == id_ex_dr))) && !(ex_mem_in_ld))
		forward2 = 2'b01;
	else if(ex_mem_regwrite && (ex_mem_dr == id_ex_sr2) || (id_ex_in_st && (ex_mem_dr == id_ex_dr)))
		forward2 = 2'b10;
	else if(mem_wb_regwrite && (mem_wb_dr == id_ex_sr2) || (id_ex_in_st && (ex_mem_dr == id_ex_dr)))
		forward2 = 2'b11;
	else
		forward2 = 2'b00;
end

endmodule : forward_unit
